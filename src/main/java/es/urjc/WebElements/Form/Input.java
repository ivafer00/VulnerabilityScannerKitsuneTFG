package es.urjc.WebElements.Form;

import com.google.common.reflect.TypeToken;
import com.google.gson.Gson;

import java.util.HashMap;

public class Input {

    private final String id;
    private final String name;
    private final String type;
    private String value;
    private String preallocatedValue;
    private String unexpectedValue;
    private final boolean isVisible;

    public Input(String id, String name, String type, String value, boolean isVisible) {
        this.id = id;
        this.name = name;
        this.type = type;
        this.preallocatedValue = value;
        this.value = "";
        this.unexpectedValue = "";
        this.isVisible = isVisible;
    }

    public boolean haveSameValue(String value){
        return this.value.equals(value);
    }

    public boolean haveSameType(String type){
        return this.type.equals(type);
    }

    public boolean havePreallocatedValue(){
        return !this.preallocatedValue.isEmpty();
    }

    public boolean haveUnexpectedValue(){
        return !this.unexpectedValue.isEmpty();
    }

    public void setValueAsRandom(){
        this.value = Input.valueAsRandom(this.type);
    }

    public void setUnexpectedValue(String unexpectedValue) {
        this.unexpectedValue = unexpectedValue;
    }
    
    public void setValueAsPreallocated(){
        this.value = this.preallocatedValue;
    }

    public void setValue(String value) {
        this.value = value;
    }

    public String getValue() {
        return value;
    }

    public String getPreallocatedValue() {
        return preallocatedValue;
    }

    public void setPreallocatedValue(String preallocatedValue) {
        this.preallocatedValue = preallocatedValue;
    }

    public void fillValue(){
        if(this.haveUnexpectedValue()) this.setValue(this.unexpectedValue);
        else if(this.havePreallocatedValue()) this.setValue(this.preallocatedValue);
        else this.setValueAsRandom();
    }

    public void clearValue(){
        this.value = "";
    }

    public boolean isAPossibleCSRFToken(){
        return (this.haveSameType("hidden") || this.haveSameType("addedByJS")) && this.havePreallocatedValue();
    }

    public boolean isUsernameValue(){
        return this.id.contains("user") || this.id.contains("mail") || this.name.contains("user") || this.name.contains("mail");
    }

    public boolean isPasswordValue(){
        return this.id.contains("pass") || this.name.contains("pass");
    }

    public boolean isVisible() {
        return isVisible;
    }



    @Override
    public String toString() {
        return name + '\t' + type + '\t' + preallocatedValue + '\t' + unexpectedValue;
    }

    public static String valueAsRandom(String type){
        if(type.equals("number")){
            return "1";
        } else if (type.equals("email") || type.equals("password") || type.equals("text")){
            return  "a";
        }
        return "";
    }
}
