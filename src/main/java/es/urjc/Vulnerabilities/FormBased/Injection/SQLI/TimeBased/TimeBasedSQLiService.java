package es.urjc.Vulnerabilities.FormBased.Injection.SQLI.TimeBased;


import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import java.util.ArrayList;
import java.util.List;
import java.util.Optional;

@Service
public class TimeBasedSQLiService {
    @Autowired
    protected TimeBasedSQLiRepository timeBasedSQLiRepository;

    public List<TimeBasedSQLi> findAll(){
        return this.timeBasedSQLiRepository.findAll();
    }

//    @PostConstruct
//    public void init(){
//        timeBasedSQLiRepository.save(new TimeBasedSQLi("1 AND (select sleep(##sleep_time##) from dual where database()); #", 2));
//        timeBasedSQLiRepository.save(new TimeBasedSQLi("1' AND (select sleep(##sleep_time##) from dual where database()); #", 2));
//    }

    public List<TimeBasedSQLi> findById(Long[] timeBasedSQLIdentifiers){
        List<TimeBasedSQLi> timeBasedSQLiList = new ArrayList<>();
        for (Long timeBasedSQLIdentifier: timeBasedSQLIdentifiers) {
            Optional<TimeBasedSQLi> optional = this.timeBasedSQLiRepository.findById(timeBasedSQLIdentifier);
            optional.ifPresent(timeBasedSQLiList::add);
        }
        return timeBasedSQLiList;
    }
}
