package es.urjc.Vulnerabilities.FormBased.Injection.XSS;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import javax.annotation.PostConstruct;
import java.util.ArrayList;
import java.util.List;
import java.util.Optional;

@Service
public class XSSService {
    @Autowired
    protected XSSRepository xssRepository;

    public List<XSSInjection> findAll(){
        return this.xssRepository.findAll();
    }

    //        Injection i = new XSSInjection("<script>var r=new XMLHttpRequest();var f=new FormData();f.append('s','#scanner_id#');f.append('f','#form_id#');f.append('i','#input_id#');f.append('p',#payload_id#);r.open('POST','#server_id#',true);r.send(f)</script>");
//    @PostConstruct
//    public void init(){
//        xssRepository.save(new XSSInjection("<scRipt>console.error('#scanner_id#-#form_id#-#input_id#-#payload_id#')</script>"));
//        xssRepository.save(new XSSInjection("<imG src=x onerror=console.error('#scanner_id#-#form_id#-#input_id#-#payload_id#')>"));
//        xssRepository.save(new XSSInjection("%3CbOdy%20onload=Function('conso'%2B'le.er'%2B'ror(\\\"#scanner_id#-#form_id#-#input_id#-#payload_id#\\\")')() >"));
//        xssRepository.save(new XSSInjection("<input autofocus onfocus=console.error('#scanner_id#-#form_id#-#input_id#-#payload_id#')>"));
//    }

    public List<XSSInjection> findById(Long[] xssInjectionIdentifiers){
        List<XSSInjection> xssInjectionList = new ArrayList<>();
        for (Long xssIdentifier: xssInjectionIdentifiers) {
            Optional<XSSInjection> optional = this.xssRepository.findById(xssIdentifier);
            optional.ifPresent(xssInjectionList::add);
        }
        return xssInjectionList;
    }
}
