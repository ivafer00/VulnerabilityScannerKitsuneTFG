var createFormInformation = function(form){
    var accordionId = "#accordion_unauth";
    var accordion = document.getElementById("accordion_unauth");
    if(form["isAuthenticated"]){
        accordion = document.getElementById("accordion_auth");
        accordionId = "#accordion_auth";
    }
    var card = document.createElement("div");
    card.className = "card";

    var cardHeader = document.createElement("div");
    cardHeader.className = "card-header bg-secondary";
    cardHeader.id = "heading" + form["formId"];

    var h5 = document.createElement("h5");
    h5.className = "mb-0";

    var headerButton = document.createElement("button");
    headerButton.className = "btn btn-link text-white";
    headerButton.setAttribute('data-toggle', 'collapse');
    headerButton.setAttribute('data-target', '#collapse' + form["formId"]);
    headerButton.setAttribute('aria-controls', '#collapse' + form["formId"]);
    headerButton.innerText = form["submitUrl"] + "\t" + form["method"] + "\t#" + form["formId"];


    h5.append(headerButton);
    cardHeader.append(h5);
    card.append(cardHeader);

    var collapsableBody = document.createElement("div");
    collapsableBody.id = "collapse" + form["formId"];
    collapsableBody.className = "collapse";
    collapsableBody.setAttribute("aria-labelledby", cardHeader.id);
    collapsableBody.setAttribute("data-parent", accordionId);

    var cardBody = document.createElement("div")
    cardBody.class = "";

    var generalInformationDiv = document.createElement("div")
    generalInformationDiv.className = "float-left w-50";
//    generalInformationDiv.style.width = "50%";

    var formIdParagraph = document.createElement("p");
    var bformIdParagraph = document.createElement("b");
    bformIdParagraph.innerText = "ID del formulario: "
    formIdParagraph.innerText = form["formId"];

    var formMethod = document.createElement("p");
    var bformMethod = document.createElement("b");
    bformMethod.innerText = "Método: ";
    formMethod.innerText = form["method"];

    var formCurrentUrl = document.createElement("p");
    var bformCurrentUrl = document.createElement("b");
    bformCurrentUrl.innerText = "Encontrado en: ";
    formCurrentUrl.innerText = form["currentUrl"];

    var formSubmitUrl = document.createElement("p");
    var bformSubmitUrl = document.createElement("b");
    bformSubmitUrl.innerText = "Endpoint: ";
    formSubmitUrl.innerText += form["submitUrl"];

    var formInputList = document.createElement("table");
    formInputList.className = "table table-bordered table-dark";

    var tableHeaders = document.createElement("tr");
    tableHeaders.innerHTML = "<th>Nombre</th><th>Tipo</th><th>Valor por defecto</th><th>¿Sufre cambios?</th>"
    formInputList.append(tableHeaders);
    for(var i=0; i<form["inputs"].length;i++){
        var row = document.createElement("tr");
        var inputInfo = form["inputs"][i].split("\t");
        var tdName = document.createElement("td");
        tdName.innerText = inputInfo[0];
        var tdType = document.createElement("td");
        tdType.innerText = inputInfo[1];
        var tdValue = document.createElement("td");
        tdValue.innerText = inputInfo[2];
        var tdIsModified = document.createElement("td");
        if(inputInfo[3].length != 0){
            tdIsModified.innerText = "true (" + inputInfo[3] + ")";
        } else {
            tdIsModified.innerText = "false";
        }
        row.append(tdName);
        row.append(tdType);
        row.append(tdValue);
        row.append(tdIsModified);
        formInputList.append(row);
    }

    generalInformationDiv.append(bformIdParagraph);
    generalInformationDiv.append(formIdParagraph);
    generalInformationDiv.append(bformMethod);
    generalInformationDiv.append(formMethod);
    generalInformationDiv.append(bformCurrentUrl);
    generalInformationDiv.append(formCurrentUrl);
    generalInformationDiv.append(bformSubmitUrl);
    generalInformationDiv.append(formSubmitUrl);
    generalInformationDiv.append(formInputList);

    cardBody.append(generalInformationDiv);

    var securityInformationDiv = document.createElement("div");
    securityInformationDiv.className = "float-right w-50";
    var securityTable = document.createElement("table");
    securityTable.className = "table table-bordered";

    tableHeaders = document.createElement("tr");
    tableHeaders.innerHTML = "<th>Estado XSS</th><th>Estado SQL Injection</th><th>Estado CSRF</th>";

    var row = document.createElement("tr");
    var tdXSS = document.createElement("td");
    tdXSS.id = "XSS" + form["formId"];
    tdXSS.innerText = "Esperando validación...";

    var tdSQLi = document.createElement("td");
    tdSQLi.id = "SQLi" + form["formId"];
    tdSQLi.innerText = "Esperando validación...";

    var tdCSRF = document.createElement("td");
    tdCSRF.id = "CSRF" + form["formId"];
    tdCSRF.innerText = "Esperando validación...";

    row.append(tdXSS);
    row.append(tdSQLi);
    row.append(tdCSRF);

    securityTable.append(tableHeaders);
    securityTable.append(row);

    securityInformationDiv.append(securityTable);
    cardBody.append(securityInformationDiv);
    collapsableBody.append(cardBody);

    card.append(collapsableBody);
    accordion.append(card);
}

var updateVulnerabilityState = function(responseStatus){
    var formId = responseStatus["formId"];
    var statusCode = responseStatus["statusCode"];
    var vulnerabilityName = responseStatus["vulnerabilityName"];

    var tableCell = document.getElementById(vulnerabilityName + formId);
    var text = tableCell.innerText;

    if(text === "Esperando validación..."){
        if(isValidResponse(statusCode)){
            tableCell.innerText = "valid: statusCode = " + statusCode;
            tableCell.className = "bg-success";
        } else {
            tableCell.innerText = "error: statusCode = " + statusCode;
            tableCell.className = "bg-warning";

            var heading = document.getElementById("heading" + formId);
            if(heading.className !== "card-header bg-danger")heading.className = "card-header bg-warning";
        }
    }
}

var isValidResponse = function(statusCode){
    return statusCode >= 200 && statusCode <= 399;
}