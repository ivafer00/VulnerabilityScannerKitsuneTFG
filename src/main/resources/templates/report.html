<!DOCTYPE html>
<html>
	<head>

		<meta charset="UTF-8">
		<title>Kitsune</title>

		<script src="https://unpkg.com/cytoscape/dist/cytoscape.min.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
		<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.0/css/all.css" integrity="sha384-lZN37f5QGtY3VHgisS14W3ExzMWZxybE1SJSEsQp9S+oqd12jhcu+A56Ebc1zFSJ" crossorigin="anonymous">

		<script src="./js/graph.js"></script>
		<link rel="stylesheet" href="./css/style.css">

	</head>
	<body>
		<nav class="navbar navbar-expand-sm bg-dark navbar-dark">
			<a class="navbar-brand" href="#">
				<img src="/images/icon.png" alt="logo" style="height:50px;">
			</a>
			<ul class="nav navbar-nav nav-tabs text-white">
				<li class="nav-item">
					<a class="nav-link active text-white bg-dark" data-toggle="tab" href="#HOME">Home</a>
				</li>
				<li class="nav-item">
					<a class="nav-link text-white bg-dark" data-toggle="tab" href="#GRAPHS">Modelo de la aplicación</a>
				</li>
				<li class="nav-item">
					<a class="nav-link text-white bg-dark" data-toggle="tab" href="#XSS">XSS</a>
				</li>
				<li class="nav-item">
					<a class="nav-link text-white bg-dark" href="/scan_configurer.html">Volver a la página inicial</a>
				</li>
			</ul>
		</nav>

		<div class="tab-content">

			<div class="tab-pane container active" id="HOME">
				<div class="container bg-info text-white">
					<h1>Bienvenido al escáner de vulnerabilidades.</h1>
					<p>URL: {{report.initialUrl}}</p>
					<p>URLBase: {{report.baseUrl}}</p>
					{{#reportWithLogin}}
					<p>Usuario: {{report.username}}</p>
					<p>Contraseña: {{report.password}}</p>
					{{/reportWithLogin}}
				</div>
			</div>

			<div class="tab-pane container fade" id="GRAPHS">
				{{#urlMappingAnonymousUserExists}}
					<button id="anonymous" data-toggle="modal" data-target="#AnonymousMap">Ver mapa de red de usuario anónimo</button>
					<div class="modal fade" id="AnonymousMap">
						<div class="modal-dialog mw-100 w-75">
							<div class="modal-content">
								<div class="modal-header">
									Mapa de usuario anónimo
								</div>
								<div class="modal-body">
									<div id="urlMapAnonymousUser" style="height: 700px; width:100%;"></div>
								</div>
								<div class="modal-footer">
									<button name="circle" onclick="rerunLayout(this)">Circle</button>
									<button name="grid" onclick="rerunLayout(this)">Grid</button>
								</div>
							</div>
						</div>
					</div>
					<script>
						var baseUrl = "{{report.baseUrl}}";
						var mapAnonymousUser = "{{urlMappingAnonymousUser}}";
						var graphAnonymousUser = getGraphFromRawData(mapAnonymousUser);
						var cyForAnonymous = getCytoscapeGraph("urlMapAnonymousUser", graphAnonymousUser, baseUrl);
					</script>

				{{/urlMappingAnonymousUserExists}}

				{{#urlMappingAuthenticatedUserExists}}
					<button id="authenticated" data-toggle="modal" data-target="#AuthenticatedMap">Ver mapa de red de usuario autenticado</button>
					<div class="modal fade" id="AuthenticatedMap">
						<div class="modal-dialog mw-100 w-75">
							<div class="modal-content">
								<div class="modal-header">
									Mapa de usuario autenticado
								</div>
								<div class="modal-body">
									<div id="urlMapAuthenticatedUser" style="height: 700px; width:100%;"></div>
								</div>
								<div class="modal-footer">
									<button name="circle" onclick="rerunLayout(this)">Circle</button>
									<button name="grid" onclick="rerunLayout(this)">Grid</button>
								</div>
							</div>
						</div>
					</div>
					<script>
						var baseUrl = "{{report.baseUrl}}";
						var mapAuthenticatedUser = "{{urlMappingAuthenticatedUser}}";
						var graphAuthenticatedUser = getGraphFromRawData(mapAuthenticatedUser);
						console.log(graphAuthenticatedUser);
						var cyForAuthenticated = getCytoscapeGraph("urlMapAuthenticatedUser", graphAuthenticatedUser, baseUrl);
					</script>
				{{/urlMappingAuthenticatedUserExists}}
			</div>

			<div class="tab-pane container fade" id="XSS">
			{{#vulnerableForms}}
				<div class="container bg-danger text-white" style="height: 700px; margin-top: 25px;">
					<h2>Formulario vulnerable a XSS encontrado:</h2>
					<div class="row">
						<div class="col">
							<p>URL del formulario: {{localUrl}}</p>
						</div>
						<div class="col">
							<p>URL destino: {{submitUrl}}</p>
						</div>
					</div>
					<div class="row">
						<div class="col">
							<p>Método: {{method}}</p>
						</div>
					</div>
					<div class="row">
						<div class="col">
							<p>Campo vulnerable: {{isXSSVulnerable}}</p>
						</div>
					</div>
							<label>Ejemplo de exploit:</label>
							<div class="editor">
								<div class="editor__wrapper">
									<div class="editor__body">
										<input class="editor__default__code" type="hidden" value="{{.}}">
										<div id="editorCode" class="editor__code"></div>
									</div>
									<div class="editor__footer">
										<div class="editor__footer--left">
											<button class="editor__btn editor__run btn btn-circle bg-light"><span class="fa fa-play"></span></button>
											<button class="editor__btn editor__reset btn btn-circle bg-light"><span class="fa fa-trash-alt"></span></button>
											<button class="editor__btn editor__save btn btn-circle bg-light"><span class="fas fa-save"></span></button>
										</div>
										<div class="editor__footer--right">
											<div class="editor__console">
												<ul class="editor__console-logs"></ul>
											</div>
										</div>
									</div>
								</div>
							</div>
							<!-- Required Ace Libraries -->
							<script src="ace/ace.js"></script>
							<script src="ace/mode-javascript.js"></script>
							<script src="ace/ext-language_tools.js"></script>
							<script src="js/ace-console.js"></script>
							<script src="js/ace-editor.js"></script>
					<br>
				</div>
			{{/vulnerableForms}}
			</div>
		</div>

	</body>
</html>